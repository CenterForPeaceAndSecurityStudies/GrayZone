---
title: "07_FullData"
author: J Andres Gannon, Erik Gartzke, and Jon Lindsay, Center for Peace and Security
  Studies (cPASS)
date: "`r Sys.Date()`"
output:
  pdf_document:
    toc: yes
    toc_depth: '5'
  html_notebook:
    fig_height: 8
    fig_width: 12
    number_sections: yes
    theme: flatly
    toc: yes
    toc_depth: 5
    toc_float:
      collapsed: yes
  html_document:
    df_print: paged
    toc: yes
    toc_depth: '5'
editor_options:
  chunk_output_type: inline
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This document compares case and variable coverage across all the Russia cyber data investigated.

The data comes from the following sources:

ICB comes from Brecher, Michael and Jonathan Wilkenfeld (2000). A Study of Crisis. Ann Arbor: University of Michigan Press.

DCID comes from Valeriano, B., & Maness, R. C. (2014). The dynamics of cyber conflict between rival antagonists, 2001–11. Journal of Peace Research, 51(3), 347–360. https://doi.org/10.1177/0022343313518940

REI comes from Casey, Adam; Way, Lucan Ahmad, 2017, "Russian Electoral Interventions, 1991-2017", https://doi.org/10.5683/SP/BYRQQS, Scholars Portal Dataverse

# Preparation
## Load packages
Pipe operators have trouble loading for individual commands
```{r}
library(magrittr)
library(ggplot2)
```

## Load data
Load the cleaned and subset versions of each dataset
```{r}
# Load data
cpass <- readRDS(paste0(here::here(), '/data/grayzone_cpass.rds'))
icb <- readRDS(paste0(here::here(), '/data/grayzone_icb.rds'))
dcid <- readRDS(paste0(here::here(), '/data/grayzone_dcid.rds'))
rei <- readRDS(paste0(here::here(), '/data/grayzone_rei.rds'))
```

# Compare coverage
Before merging the data, compare the different cases covered by each one
```{r}
# Create identifier variables for each dataset
cpass$cpass <- 1
icb$icb <- 1
dcid$dcid <- 1
rei$rei <- 1

# Ensure proper unit of analysis
dplyr::glimpse(cpass)
dplyr::glimpse(icb)
dplyr::glimpse(dcid)
dplyr::glimpse(rei)

# Fix dcid dates to have a year column
dcid <- tidyr::separate(dcid, 'Start date', c("Start Year", "Start Month", "Start Day"), sep = "-")
dcid <- tidyr::separate(dcid, 'End date', c("End Year", "End Month", "End Day"), sep = "-")

# Rename merging variables to make things easier
cpass <- cpass %>% dplyr::rename('Target' = target,
                                 'Year' = year_start)

icb <- icb %>% dplyr::rename('Target' = Target,
                             'Year' = Year)

dcid <- dcid %>% dplyr::rename('Target' = Target,
                               'Year' = 'Start Year')

rei <- rei %>% dplyr::rename('Target' = Target,
                             'Year' = Year)

# Fix date types
cpass$Year <- as.numeric(cpass$Year)
icb$Year <- as.numeric(icb$Year)
dcid$Year <- as.numeric(dcid$Year)
rei$Year <- as.numeric(rei$Year)

# Create dataframe versions of just variables to merge for the match
cpass_join <- cpass[ , c('Target', 'Year', 'cpass')]
icb_join <- icb[ , c('Target', 'Year', 'icb')]
dcid_join <- dcid[ , c('Target', 'Year', 'dcid')]
rei_join <- rei[ , c('Target', 'Year', 'rei')]

coverage <- plyr::join_all(list(cpass_join, icb_join, dcid_join, rei_join), by = c('Target', 'Year'), type = 'left')

coverage <- dplyr::full_join(cpass_join, icb_join) %>% dplyr::full_join(., dcid_join) %>% dplyr::full_join(., rei_join)

coverage <- unique(coverage)

coverage[is.na(coverage)] <- 0

coverage <- coverage[order(coverage$Year, decreasing = FALSE), ]

formattable::formattable(coverage,
                         align = c("c", "c", "c", "c", "c", "c"),
                         list('cpass' = formattable::color_tile("transparent", "lightblue"),
                              'icb' = formattable::color_tile("transparent", "lightblue"),
                              'dcid' = formattable::color_tile("transparent", "lightblue"),
                              'rei' = formattable::color_tile("transparent", "lightblue")))
```

# Merge data
First we identify the variables in each dataset and which are duplicates
```{r}

```

# Summary statistics
```{r}
names(rei)

```

## Summary
Make a table summarizing the data on Russian crisis participation
```{r}

```

## Plots
Given the number of cases, summarize them in plot format.
```{r}
```

# Save final dataframe
```{r}
# saveRDS(rei, paste0(here::here(), "/data/","grayzone_rei.rds"))
```
